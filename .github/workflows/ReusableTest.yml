---
name: Reusable Test
on:
  pull_request:
    inputs: {}

jobs:
  reusable:
    uses: ./.github/workflows/ReusableWorkflow.yml

  duplicate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - uses: julia-actions/setup-julia@v2
        with:
          version: "1"
      - name: Save cache
        uses: ./
      - name: Export Context
        id: export
        run: |
          jq -c <<<"$github_json" >github.json
        env:
          github_json: ${{ toJSON(github) }}
      - uses: actions/upload-artifact@v4
        with:
          name: trigger-context
          path: "*.json"

  compare:
    needs:
      - reusable
      - duplicate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: trigger-context
          path: trigger
      - uses: actions/download-artifact@v4
        with:
          name: reusable-context
          path: reusable
      - run: |
          find .
          a="$(cat trigger/github.json)"
          b="$(cat reusable/github.json)"

          echo "::group::Raw A"
          jq <<<"$a"
          echo "::endgroup::"

          echo "::group::Raw B"
          jq <<<"$b"
          echo "::endgroup::"
          
          echo "::group::Diff"
          diff <(jq <<<"$a") <(jq <<<"$b")
          echo "::endgroup::"
