---
name: Reusable Workflow
on:
  workflow_call:
    inputs: {}

jobs:
  duplicate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - uses: julia-actions/setup-julia@v2
        with:
          version: "1"
      - name: Save cache
        uses: ./
      - name: Export Context
        run: |
          jq -c <<<"$github_json" >github.json
          jq -c <<<"$env_json" >env.json
          jq -c <<<"$job_json" >job.json
          jq -c <<<"$steps_json" >steps.json
          jq -c <<<"$runner_json" >runner.json
          jq -c <<<"$inputs_json" >inputs.json
        env:
          github_json: ${{ toJSON(github) }}
          env_json: ${{ toJSON(env) }}
          job_json: ${{ toJSON(job) }}
          steps_json: ${{ toJSON(steps) }}
          runner_json: ${{ toJSON(runner) }}
          inputs_json: ${{ toJSON(inputs) }}
      - name: Export environmental variables
        run: jq -n env >env_vars.json
      - uses: actions/upload-artifact@v4
        with:
          name: reusable-context
          path: "*.json"
      - run: |
          set -x
          uuid="$(cat /proc/sys/kernel/random/uuid)"
          echo "$uuid"
          # sleep 60
          # https://docs.github.com/en/rest/actions/workflow-runs?apiVersion=2022-11-28#download-workflow-run-logs
          # gh api "/repos/{owner}/{repo}/actions/runs/${run_id:?}/logs" >logs.zip
          # unzip -- logs.zip "*.txt"
          # find .
          # grep -rnH ReusableWorkflow.yml .
          # grep -rnH "$uuid" .
          gh run view "${run_id:?}" --log
        env:
          GH_TOKEN: ${{ github.token }}
          run_id: ${{ github.run_id }}
